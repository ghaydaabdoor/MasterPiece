@model IEnumerable<MasterPiece.Models.Cloth>

@{
    ViewBag.Title = "الملابس";
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
}
<link href="~/Content/ClothsCards.css" rel="stylesheet" />

<main class="main">

    <!-- EachService Section -->
    <section id="EachService" class="EachService section">

        <!-- Section Title -->
        <div class="container" data-aos="fade-up">
            <p class="Eachsection-title">خدمات الملابس<br></p>
            <p class="Eachsection-description">
                اكتشف مجموعتنا الرائعة من خدمات تأجير الملابس للعروس والعريس، حيث
                نوفر لكم تجربة مميزة لاختيار إطلالتكم الأنيقة ليومكم الخاص. تضمن خدماتنا تلبية احتياجاتكم بأسلوب
                راقي واحترافي، مما يجعل لحظاتكم لا تُنسى
            </p>
            <div class="Eachsection-description">
                <p>خدماتنا تشمل</p>
                <p>فساتين الزفاف: مجموعة متنوعة من الفساتين بأحدث التصاميم والأنماط</p>
                <p>البدلات الرجالية: تشكيلة من البدلات الأنيقة والموديلات الحديثة لإطلالة العريس المثالية</p>
            </div>

            <div class="alert alert-warning" role="alert" style="font-size: 14px; text-align: right; margin-top: 20px;">
                تنبيه: خدمة تأجير الملابس متاحة فقط بعد إتمام حجز صالة أو مزرعة. نقدر تعاونكم ونتطلع لخدمتكم
            </div>



            <div class="custom-dropdown">
                <select class="custom-select-dropdown" id="categoryValue" onchange="clothesOnCategory()">
                    <option selected disabled>الصنف</option>
                    <option value="فساتين أعراس">فساتين اعراس</option>
                    <option value="بدلات رجالية">بدلات رجالية</option>
                </select>
            </div>




        </div><!-- End Section Title -->

        <div class="container">

            <div class="row gy-4" id="clothesContainer">
                @foreach (var item in Model)
                {
                    <div class="col-lg-4 col-md-6 card-item" data-category="@item.Category" data-aos="fade-up" data-aos-delay="100">
                        <div class="card">
                            <div class="card-img">
                                <img src="~/Content/img/@item.ImageUrl" alt="" class="img-fluid">
                            </div>
                            <h3>@item.Name</h3>
                            <p>اللون: @item.Color</p>
                            <p>السعر: @item.ClothDetails.FirstOrDefault(d => d.ClothDetailId == item.ClothId).PriceDetails</p>
                            <div class="stars">
                                <a class="btn-getstarted details-btn" id="det" href="@Url.Action("Index", "ClothDetails", new {id=item.ClothId})">التفاصيل</a>
                                <a class="btn-getstarted details-btn cart" href="javascript:void(0);" onclick="checkBooking(@item.ClothId)">احجز الآن</a>
                                <span>@item.Rate (20)</span>
                                <div><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i></div>
                            </div>
                        </div>
                    </div>
                    <!-- End Card Item -->
                }
            </div>

        </div>

    </section><!-- /EachService Section -->

</main>

<script>
    function clothesOnCategory() {
        var selectedCategory = document.getElementById("categoryValue").value;
        var clothCards = document.querySelectorAll(".card-item");
        clothCards.forEach(function (card) {
            var cardCategory = card.getAttribute("data-category");
            if (selectedCategory === cardCategory || selectedCategory === "الصنف") {
                card.style.display = "block";
            } else {
                card.style.display = "none";
            }
        });
    }
</script>



<script>
    function checkBooking(clothId) {
        debugger;
    $.ajax({
        url: '@Url.Action("CreateClothForm", "Bookings")',
        type: 'GET',
        data: { id: clothId },
        success: function (response) {
            if (response.loginRequired) {
                // Trigger SweetAlert for login
                Swal.fire({
                    title: 'يجب تسجيل الدخول',
                    text: 'يجب تسجيل الدخول لمتابعة عملية الحجز',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'تسجيل الدخول',
                    cancelButtonText: 'إلغاء',
                    reverseButtons: true,
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Get the relative URL (excluding the protocol and domain)
                        var returnUrl = '@Url.Action("CreateClothFormView", "Bookings", new { id = "__id__" })'.replace('__id__', clothId);

                        // Redirect to the login page with the relative returnUrl
                        window.location.href = '@Url.Action("Login", "Users")' + '?returnUrl=' + encodeURIComponent(returnUrl);
                    }
                });
            } else if (response.redirect) {
                window.location.href = response.redirect; // Redirect to the cloth form
            } else if (response.alert) {
                Swal.fire({
                    title: 'تنبيه',
                    text: response.message,
                    icon: 'warning',
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'حسناً'
                });
            } else {
                Swal.fire({
                    title: 'خطأ',
                    text: 'حدث خطأ أثناء معالجة طلبك.',
                    icon: 'error',
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'حسناً'
                });
            }
        },
        error: function () {
            Swal.fire({
                title: 'خطأ',
                text: 'حدث خطأ أثناء معالجة طلبك.',
                icon: 'error',
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'حسناً'
            });
        }
    });
}


</script>




